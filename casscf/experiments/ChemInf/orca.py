from pyscf import gto, scf, lib
from mokit.lib.fch2py import fch2py
from mokit.lib.ortho import check_orthonormal
import casscf.code.pyscf_tools as pyscfTools
import pyscf


lib.num_threads(12) # 2 CPU cores
mol = gto.M()
# 55 atom(s)
mol.atom = '''
C1          48.304001260        82.334000670        38.831001190
C2          48.926998260        81.214996190        37.964001170
C3          49.191002230        80.010002530        38.830002210
N1          50.513000250        79.638000470        39.112999200
C4          50.859001230        78.314003320        39.622002220
C5          50.230000250        77.148003140        38.789001190
N2          49.966999220        76.052002530        39.569000200
C6          49.744999220        74.776001220        38.998001210
C7          51.153000240        74.147003200        38.827999170
C8          51.292000270        72.727997570        38.223999210
C9          52.061001230        71.695000260        38.799000210
C10          51.884998270        70.514999110        37.965000200
C11          52.176998250        69.130997500        38.245998170
C12          52.972000390        68.719002350        39.458000200
C13          52.790001260        68.919998150        40.747002220
C14          51.779999240        69.577003400        41.452000200
C15          51.921001260        69.444000530        42.855999210
C16          53.134998080        68.879997110        43.457001220
N3          54.014999140        68.154999460        42.667000230
N4          53.796001270        68.224998490        41.340000220
N5          54.599998200        67.521004420        40.509998200
C17          54.132999310        67.806000210        39.293999190
H1          54.577999250        67.372002400        38.408001170
H2          53.252998250        68.875999180        44.533001210
H3          51.243000260        69.962997430        43.522999200
H4          50.957001250        70.106003340        40.985001210
C18          51.696999280        68.206001560        37.337002160
C19          50.956001270        68.733002270        36.200001160
N6          50.645000280        70.013000440        35.981998190
C20          51.062000280        70.892998330        36.884998200
N7          50.787998250        72.241997520        37.016998170
H5          50.278000270        72.744003600        36.305000180
H6          50.644001240        68.017998130        35.439999180
Cl1          52.063999230        66.491997100        37.480999170
H7          52.578999260        71.834000300        39.741001210
H8          51.623001250        74.123001310        39.819000180
H9          51.745998230        74.836998420        38.214001200
H10          49.205002240        74.931999490        38.056999190
H11          49.089001250        74.150002570        39.617001180
H12          49.895000270        76.105003330        40.577999220
O1          50.216000230        77.134003230        37.542000180
C21          52.416000240        78.224998360        39.567001180
C22          52.966999130        79.611000260        39.289001210
C23          51.752998240        80.297997170        38.665001210
H13          51.851002230        80.208000530        37.576000180
H14          51.780998280        81.364998350        38.919998220
H15          53.861000110        79.653999620        38.653999200
H16          53.152000010        80.039001440        40.282001190
H17          52.716000270        77.467003340        38.834000200
H18          52.784000290        77.889000470        40.543999210
H19          50.521999220        78.165001310        40.654999210
O2          48.243000250        79.397003640        39.367001190
H20          49.748001250        81.601997240        37.348999190
H21          48.512001240        82.193001400        39.897999200
H22          47.213001260        82.390999400        38.729000170
'''

mol.basis = {
'C1': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C2': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C3': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'N1': gto.basis.parse('''
N     S
    0.991061690E+02    0.154328970E+00
    0.180523120E+02    0.535328141E+00
    0.488566020E+01    0.444634541E+00
N     SP
    0.378045590E+01   -0.999672284E-01    0.155916269E+00
    0.878496600E+00    0.399512824E+00    0.607683714E+00
    0.285714400E+00    0.700115459E+00    0.391957386E+00
'''),
'C4': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C5': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'N2': gto.basis.parse('''
N     S
    0.991061690E+02    0.154328970E+00
    0.180523120E+02    0.535328141E+00
    0.488566020E+01    0.444634541E+00
N     SP
    0.378045590E+01   -0.999672284E-01    0.155916269E+00
    0.878496600E+00    0.399512824E+00    0.607683714E+00
    0.285714400E+00    0.700115459E+00    0.391957386E+00
'''),
'C6': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C7': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C8': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C9': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C10': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C11': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C12': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C13': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C14': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C15': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C16': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'N3': gto.basis.parse('''
N     S
    0.991061690E+02    0.154328970E+00
    0.180523120E+02    0.535328141E+00
    0.488566020E+01    0.444634541E+00
N     SP
    0.378045590E+01   -0.999672284E-01    0.155916269E+00
    0.878496600E+00    0.399512824E+00    0.607683714E+00
    0.285714400E+00    0.700115459E+00    0.391957386E+00
'''),
'N4': gto.basis.parse('''
N     S
    0.991061690E+02    0.154328970E+00
    0.180523120E+02    0.535328141E+00
    0.488566020E+01    0.444634541E+00
N     SP
    0.378045590E+01   -0.999672284E-01    0.155916269E+00
    0.878496600E+00    0.399512824E+00    0.607683714E+00
    0.285714400E+00    0.700115459E+00    0.391957386E+00
'''),
'N5': gto.basis.parse('''
N     S
    0.991061690E+02    0.154328970E+00
    0.180523120E+02    0.535328141E+00
    0.488566020E+01    0.444634541E+00
N     SP
    0.378045590E+01   -0.999672284E-01    0.155916269E+00
    0.878496600E+00    0.399512824E+00    0.607683714E+00
    0.285714400E+00    0.700115459E+00    0.391957386E+00
'''),
'C17': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'H1': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H2': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H3': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H4': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'C18': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C19': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'N6': gto.basis.parse('''
N     S
    0.991061690E+02    0.154328970E+00
    0.180523120E+02    0.535328141E+00
    0.488566020E+01    0.444634541E+00
N     SP
    0.378045590E+01   -0.999672284E-01    0.155916269E+00
    0.878496600E+00    0.399512824E+00    0.607683714E+00
    0.285714400E+00    0.700115459E+00    0.391957386E+00
'''),
'C20': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'N7': gto.basis.parse('''
N     S
    0.991061690E+02    0.154328970E+00
    0.180523120E+02    0.535328141E+00
    0.488566020E+01    0.444634541E+00
N     SP
    0.378045590E+01   -0.999672284E-01    0.155916269E+00
    0.878496600E+00    0.399512824E+00    0.607683714E+00
    0.285714400E+00    0.700115459E+00    0.391957386E+00
'''),
'H5': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H6': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'Cl1': gto.basis.parse('''
Cl    S
    0.601345614E+03    0.154328967E+00
    0.109535854E+03    0.535328142E+00
    0.296446769E+02    0.444634542E+00
Cl    SP
    0.389604189E+02   -0.999672292E-01    0.155916275E+00
    0.905356348E+01    0.399512826E+00    0.607683719E+00
    0.294449983E+01    0.700115469E+00    0.391957393E+00
Cl    SP
    0.212938649E+01   -0.219620369E+00    0.105876043E-01
    0.594093427E+00    0.225595434E+00    0.595167005E+00
    0.232524141E+00    0.900398426E+00    0.462001012E+00
'''),
'H7': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H8': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H9': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H10': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H11': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H12': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'O1': gto.basis.parse('''
O     S
    0.130709320E+03    0.154328969E+00
    0.238088610E+02    0.535328136E+00
    0.644360830E+01    0.444634536E+00
O     SP
    0.503315130E+01   -0.999672287E-01    0.155916268E+00
    0.116959610E+01    0.399512825E+00    0.607683714E+00
    0.380389000E+00    0.700115461E+00    0.391957386E+00
'''),
'C21': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C22': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'C23': gto.basis.parse('''
C     S
    0.716168370E+02    0.154328970E+00
    0.130450960E+02    0.535328140E+00
    0.353051220E+01    0.444634540E+00
C     SP
    0.294124940E+01   -0.999672301E-01    0.155916272E+00
    0.683483100E+00    0.399512830E+00    0.607683728E+00
    0.222289900E+00    0.700115470E+00    0.391957395E+00
'''),
'H13': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H14': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H15': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H16': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H17': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H18': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H19': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'O2': gto.basis.parse('''
O     S
    0.130709320E+03    0.154328969E+00
    0.238088610E+02    0.535328136E+00
    0.644360830E+01    0.444634536E+00
O     SP
    0.503315130E+01   -0.999672287E-01    0.155916268E+00
    0.116959610E+01    0.399512825E+00    0.607683714E+00
    0.380389000E+00    0.700115461E+00    0.391957386E+00
'''),
'H20': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H21': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
'''),
'H22': gto.basis.parse('''
H     S
    0.342525091E+01    0.154328971E+00
    0.623913730E+00    0.535328143E+00
    0.168855400E+00    0.444634542E+00
''')}

# Remember to check the charge and spin
mol.charge = 0
mol.spin = 0
mol.verbose = 5
mol.build(parse_arg=False)

mf = scf.RHF(mol)
mf.max_cycle = 1
mf.max_memory = 4000 # MB
mf.kernel()

# read MOs from .fch(k) file
hf_fch = 'orca.fch'
nbf = mf.mo_coeff.shape[0]
nif = mf.mo_coeff.shape[1]
mf.mo_coeff = fch2py(hf_fch, nbf, nif, 'a')
# read done


coeff = mf.mo_coeff

occ = []

CASCI, CIorb, CIocc, nevpt = pyscfTools.CASCI(mol, nActiveElectrons=6, 
                                                nActiveOrbitals=5, natocc=[], 
                                                natorb=coeff, cas_list=[118, 119, 120, 121, 122], 
                                                max_run=10, nevpt2 = True)
print(f"CASCI Energy: {CASCI.e_tot:.6f} Ha")


#dm = mf.make_rdm1()
#mf.max_cycle = 10
#mf.kernel(dm0=dm)

